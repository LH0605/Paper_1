import numpy as np
import matplotlib.pyplot as plt
from scipy.ndimage.filters import gaussian_filter1d
# del index (4,5,6,7,9,11,15)
epsilons = [0, 0.1, 0.3, 0.5, 0.8, 0.9, 1.0, 1.3, 1.5, 2.0] # linear loss
# epsilons = [0, 0.1, 0.3, 0.5, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 1.0, 1.3, 1.5, 1.7, 2.0] # linear loss
# epsilons = [0, 1., 3., 4., 6., 8., 10., 12.] # poisson
# epsilons = [0, 1., 3., 4., 7., 8., 10., 12.] # poisson alt
# epsilons = [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.5, 2.0, 2.5, 3.0] # gaussian
# epsilons = [0, 0.1, 0.2, 0.3, 0.7, 0.8, 0.9, 1.0, 1.5, 2.0] # gaussian reduced

test_losses = [[-3.81581856,-5.21223999,-5.94121555,-6.90961156,-7.18887354,-7.5159176
,-7.87136945,-8.24739873,-8.24391147,-8.52393446,-8.61316688,-8.96930623
,-9.1513707,-9.13097099,-9.29797062,-9.33952997,-9.41123943,-9.41326576
,-9.42282602,-9.45364538,-9.46833858,-9.45046484,-9.61901484,-9.55689928
,-9.60241076,-9.63080485,-9.6141509,-9.58857245,-9.61249332,-9.66749408
,-9.65233693,-9.67157552,-9.67172579,-9.67657581,-9.68073,-9.69073753
,-9.70535457,-9.71190024,-9.70224248,-9.71003984]
,[-3.47475204,-5.16723589,-5.81339921,-6.52264919,-6.90718433,-7.5043756
,-7.82132177,-8.15193426,-8.39817843,-8.61726021,-8.73707685,-8.86612272
,-8.89131147,-9.09992212,-9.16196013,-9.33704463,-9.37581964,-9.35290723
,-9.32660309,-9.47948169,-9.44323351,-9.52202058,-9.58188763,-9.52907338
,-9.60483471,-9.60580508,-9.58821933,-9.61160028,-9.62037178,-9.62498658
,-9.63814597,-9.63344411,-9.66419422,-9.66559314,-9.68073543,-9.67497826
,-9.6632644,-9.69415109,-9.70733597,-9.69458919]
,[-3.95415174,-4.88631743,-5.93303631,-6.40847308,-6.89502282,-7.34241801
,-7.60530682,-7.81403167,-7.93627871,-8.23166625,-8.27237555,-8.55157192
,-8.64202615,-8.6930027,-8.83299688,-8.8601048,-8.94304359,-9.06462415
,-9.0887603,-9.07696793,-9.22002999,-9.26516851,-9.21050486,-9.31463077
,-9.34667969,-9.39430109,-9.39896068,-9.45287208,-9.42792677,-9.51148263
,-9.48149876,-9.48662026,-9.53218508,-9.48474583,-9.51999055,-9.53786711
,-9.56972325,-9.56921152,-9.60874111,-9.52149793]
,[-3.90345653,-4.74148811,-5.7649526,-6.04776966,-6.37940269,-6.79922908
,-7.04152017,-7.21228326,-7.357431,-7.61139105,-7.75653191,-7.84470052
,-7.87081673,-8.11525172,-8.16666936,-8.27275618,-8.31733272,-8.34741893
,-8.44190552,-8.48239879,-8.51247774,-8.62647935,-8.71323423,-8.60859955
,-8.66304014,-8.68034973,-8.80574485,-8.84764781,-8.90313713,-8.91379784
,-8.96314088,-8.94918076,-9.02667166,-8.94673948,-9.06684765,-9.07012405
,-9.01796873,-9.15114093,-9.18357557,-9.179735,]
,[-3.49683974,-4.80432564,-5.56371439,-5.93280557,-6.10961776,-6.45007374
,-6.7223212,-6.91272402,-7.03378598,-7.14628475,-7.2995629,-7.30642482
,-7.45695108,-7.59311902,-7.60625095,-7.56238819,-7.76519517,-7.78703303
,-7.94282053,-7.94637372,-8.03008651,-8.16773112,-8.17993385,-8.1870459
,-8.30000367,-8.27895641,-8.35533569,-8.38841662,-8.32385872,-8.50609621
,-8.46256733,-8.52687017,-8.57217035,-8.56233223,-8.4751563,-8.62920667
,-8.67446489,-8.69887861,-8.72937792,-8.81826536]
,[-3.65465524,-4.89348273,-5.40005688,-5.88483088,-6.15263594,-6.51686631
,-6.46964434,-6.67218819,-6.78712401,-6.95675236,-6.99994343,-6.89185442
,-7.05905624,-7.25536461,-7.41660696,-7.39897924,-7.5272093,-7.4611982
,-7.53928685,-7.69178173,-7.65647408,-7.90906935,-7.82282779,-7.91032117
,-7.84733366,-7.85700147,-8.02656969,-8.01059093,-8.0653751,-8.1050029
,-8.16332974,-8.2054749,-8.28064487,-8.34508133,-8.36251534,-8.31923697
,-8.40149114,-8.36183219,-8.43939796,-8.46141513]
,[-3.47929508,-4.67807906,-5.20777764,-5.68565359,-5.86659674,-6.05757925
,-6.1577825,-6.32522216,-6.49803488,-6.77138966,-6.88498188,-7.00337013
,-7.15808108,-6.95722204,-7.0640063,-7.12783783,-7.23043128,-7.33458575
,-7.34961141,-7.43493609,-7.39497981,-7.40403824,-7.42903664,-7.61028042
,-7.37576279,-7.70915013,-7.70362566,-7.78777234,-7.72348726,-7.86304962
,-7.75328459,-7.89719581,-7.80100019,-7.99487393,-7.98615125,-7.98612624
,-8.14537973,-8.13162628,-8.12872341,-7.99515647]
,[-3.57345351,-4.62826366,-5.12091847,-5.24657372,-5.6775698,-5.94550974
,-6.20217376,-6.13323904,-6.25740238,-6.24625619,-6.48534227,-6.55730143
,-6.60526296,-6.67940284,-6.57863972,-6.86966262,-6.82186323,-6.88918495
,-7.02205369,-7.00121934,-7.00391363,-7.01929717,-7.06361365,-7.21703891
,-7.25620504,-7.09673155,-7.32546154,-7.26309661,-7.29410075,-7.32810014
,-7.43211448,-7.5038297,-7.45832838,-7.57233146,-7.63349575,-7.52976041
,-7.70115271,-7.75452461,-7.63943866,-7.84257955]
,[-3.3895476,-4.38773591,-4.90038368,-5.28876887,-5.57325778,-5.68092076
,-5.77713771,-5.97445132,-5.92555056,-6.18576991,-6.16675398,-6.22663221
,-6.49532008,-6.22928228,-6.58672028,-6.64877839,-6.55436071,-6.55471184
,-6.72200679,-6.72635337,-6.60321148,-6.72570209,-6.69231006,-6.91583845
,-6.74217112,-6.78375071,-6.82760649,-7.07845412,-7.05715327,-6.99748667
,-7.00787038,-6.98384451,-7.08336222,-7.19942274,-7.24996519,-7.23069338
,-7.19881744,-7.04816058,-7.31364335,-7.36052927]
,[-3.30446679,-4.45101219,-5.06878402,-5.13324719,-5.60802203,-5.47622066
,-5.59664546,-5.77873149,-5.79444148,-5.81167585,-5.86826613,-6.10619359
,-6.01406758,-6.07345817,-6.07920083,-6.15201075,-6.29830309,-6.26687395
,-6.14038568,-6.22847809,-6.26182667,-6.27416233,-6.36930519,-6.3346845
,-6.42097798,-6.35543499,-6.48111166,-6.47603921,-6.56805356,-6.40759738
,-6.69553817,-6.55194942,-6.69801849,-6.61743653,-6.78201882,-6.72086207
,-6.69454408,-6.7055036,-6.72265867,-6.78731381]
,[-3.12181243,-4.37298531,-4.82443687,-5.08284006,-5.1034486,-5.28694447
,-5.42157133,-5.46924054,-5.52982715,-5.4167792,-5.60893491,-5.59798642
,-5.72605164,-5.58208253,-5.74932863,-5.70657339,-5.79544263,-5.68704669
,-5.94056272,-5.81711138,-5.89745919,-5.93150319,-5.79626823,-6.06732294
,-6.04889446,-5.99953888,-6.08492608,-5.98285512,-5.9135476,-6.04054684
,-6.16210043,-6.13125717,-6.06748904,-6.10308274,-6.19784357,-6.274435
,-6.22000461,-6.24622832,-6.11556043,-6.10685983]
,[-3.18508856,-4.21408375,-4.59437441,-5.01477795,-4.99473894,-5.10760813
,-5.31830701,-5.13925969,-5.32863028,-5.21669241,-5.25546021,-5.1552803
,-5.2711219,-5.26890907,-5.42339113,-5.36152429,-5.36430167,-5.33020108
,-5.40919053,-5.5264256,-5.37528106,-5.35845987,-5.41719662,-5.49407264
,-5.61830042,-5.56429701,-5.58979421,-5.57471811,-5.65565913,-5.56436546
,-5.5592171,-5.48692142,-5.56262419,-5.6230001,-5.57167781,-5.89998026
,-5.73400792,-5.59410389,-5.73369339,-5.7852375,]
,[-3.33282276,-4.24492432,-4.51332148,-4.6824582,-4.72226112,-4.94586596
,-4.9082879,-4.87670662,-5.00624726,-4.90407071,-5.18984575,-5.20244621
,-5.07444925,-5.02902472,-5.00765302,-4.83419687,-5.03891901,-4.97166287
,-4.91471346,-5.00015864,-5.01067011,-4.93819288,-4.91154213,-5.06553656
,-5.06537994,-5.08121879,-5.106345,-5.15002682,-4.95210678,-4.98195605
,-5.03190688,-5.16453223,-5.15791897,-5.1466869,-5.14822103,-5.1339641
,-5.10790353,-5.21531997,-5.12804756,-5.0761089,]
,[-3.18241082,-3.49978839,-3.84419426,-3.77356714,-3.54558385,-3.53322859
,-3.52275033,-3.48095333,-3.33793285,-3.43467764,-3.22967741,-3.22326833
,-3.00813008,-2.97161027,-2.98905269,-2.62792409,-2.71507746,-2.86552052
,-2.78449568,-2.73907078,-2.69285485,-2.67874924,-2.6196573,-2.50114961
,-2.4461158,-2.57881045,-2.2910077,-2.28961867,-2.36054196,-2.28225633
,-2.10225605,-2.2917107,-2.08235047,-2.02139244,-2.16046721,-2.14176237
,-2.06199891,-2.0496396,-1.9881147,-1.9973583,]
,[-2.78051025,-3.37497931,-3.1791227,-3.02996823,-2.87132217,-2.80675954
,-2.64912625,-2.40048897,-2.2798649,-2.38567373,-2.22808459,-2.10359154
,-2.10255462,-1.96500882,-1.88544263,-1.88264508,-1.62255814,-1.68284737
,-1.53901422,-1.52161312,-1.52771586,-1.40352181,-1.38738046,-1.33167835
,-1.34942267,-1.26335289,-1.1822488,-1.13505061,-1.18803712,-1.01681621
,-1.02019302,-1.01471317,-1.04246655,-0.86280277,-0.86920755,-0.94295219
,-0.90471071,-0.77405482,-0.83092336,-0.83224616]
,[-2.69029019,-3.06455998,-2.57092821,-2.4034805,-2.28212246,-2.0620245
,-1.78324722,-1.75207804,-1.60788198,-1.40103456,-1.37243485,-1.29306328
,-1.2895835,-1.14498616,-1.12507479,-0.89426704,-0.88136311,-0.97090723
,-0.90603427,-0.66363419,-0.78541745,-0.72996582,-0.60867262,-0.59690829
,-0.60475762,-0.48481239,-0.47284042,-0.4529905,-0.45821079,-0.4599147
,-0.42212795,-0.36710899,-0.39474626,-0.39485194,-0.36041817,-0.34378272
,-0.30452896,-0.29651303,-0.31667807,-0.32100299]
,[-2.28517139,-2.19107581,-1.84987435,-1.59437559,-1.48147777,-1.28374305
,-1.06194559,-0.94228623,-0.77226167,-0.70427779,-0.62043972,-0.58782363
,-0.53106404,-0.45978189,-0.44132015,-0.35171673,-0.33312055,-0.33508537
,-0.27719178,-0.26707696,-0.26375797,-0.20466976,-0.1975175,-0.21018092
,-0.20007657,-0.18669175,-0.17629548,-0.15980612,-0.16275625,-0.13429179
,-0.13713442,-0.14672994,-0.1286048,-0.12602595,-0.1202085,-0.10874808
,-0.11034015,-0.10924493,-0.1194111,-0.12901188]]

del(test_losses[4])
del(test_losses[4])
del(test_losses[4])
del(test_losses[4])
del(test_losses[5])
del(test_losses[6])
del(test_losses[9])

if len(epsilons) != len(test_losses):
    print(len(epsilons), len(test_losses))
    raise Exception("should be the same, check epsilons")
TRAIN_SIZE = len(test_losses[0])
train_sizes = np.arange(1, TRAIN_SIZE+1)

plt.title("Linear Loss 1D with FGM,")
plt.xlabel("Size of Training Dataset")
plt.ylabel("Test Loss")
for i in range(len(epsilons)-1,0,-1):
    print('eps:', epsilons[i])
    ysmoothed = gaussian_filter1d(test_losses[i], sigma=1)
    plt.plot(train_sizes, ysmoothed, label=f"Ɛ = {epsilons[i]}")
plt.legend(loc="right")
plt.savefig(f"linear_pgd_10d_all.png")
plt.clf()

"""
# 1
plt.title("Linear Regression Gaussian")
plt.xlabel("Size of Training Dataset")
plt.ylabel("Test Loss")
for i in [1,2,3]: # range(len(epsilons)):
    print('eps:', epsilons[i])
    plt.plot(train_sizes, test_losses[i], label=f"Ɛ = {epsilons[i]}")
plt.legend(loc="best")
plt.savefig(f"linreg_gaussian_fgsm_1d_weak.png")
plt.clf()

# 2
for i in [13, 14, 15, 16]:
    print('eps:', epsilons[i])
    plt.plot(train_sizes, test_losses[i], label=f"Ɛ = {epsilons[i]}")
plt.legend(loc="best")
plt.savefig(f"linreg_gaussian_fgsm_1d_strong.png")
"""
